<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>마이페이지</title>
	<link rel="stylesheet" th:href="@{/css/auth.css}"/>
	<link rel="stylesheet" th:href="@{/css/mypage.css}"/>
	<link rel="stylesheet" th:href="@{/css/header.css}"/>
</head>
<body>
<div th:replace="~{fragments/header :: siteHeader}"></div>

<main class="page-wrapper">
    <section class="mypage-card">
        <div class="mypage-header">
            <h1 class="mypage-title">마이페이지</h1>
            <p class="mypage-subtitle">
                내 계정 정보를 확인하고 수정할 수 있어요.
            </p>
        </div>

        <h2 class="mypage-section-title">기본 정보</h2>
        <div class="mypage-info">
            <div class="mypage-info-row">
                <span class="mypage-info-label">이름</span>
                <span class="mypage-info-value" th:text="${member.name}">홍길동</span>
            </div>
            <div class="mypage-info-row">
                <span class="mypage-info-label">이메일</span>
                <span class="mypage-info-value" th:text="${member.email}">test@gmail.com</span>
            </div>
            <div class="mypage-info-row">
                <span class="mypage-info-label">가입일</span>
                <span class="mypage-info-value"
                      th:text="${#temporals.format(member.createdAt, 'yyyy-MM-dd HH:mm')}">
                    2025-12-05 16:17
                </span>
            </div>
        </div>

        <div class="mypage-actions-main">
            <a th:href="@{/members/edit}">
                <button type="button" class="btn-primary">프로필 수정</button>
            </a>

            <a th:href="@{/members/password}">
                <button type="button" class="btn-secondary">비밀번호 변경</button>
            </a>
        </div>

        <!-- ✅ 북마크 섹션 추가 -->
        <h2 class="mypage-section-title">
            나의 북마크 
            <span class="bookmark-count" th:text="|${bookmarkCount}개|">0개</span>
        </h2>
        
        <div th:if="${#lists.isEmpty(bookmarks)}" class="bookmark-empty">
            아직 북마크한 축제가 없습니다.
        </div>

        <div th:if="${!#lists.isEmpty(bookmarks)}" class="bookmark-list">
            <div th:each="bookmark : ${bookmarks}" class="bookmark-item">
                <div class="bookmark-image-wrapper" 
                     th:if="${bookmark.imageUrl != null}">
                    <img th:src="${bookmark.imageUrl}" 
                         alt="축제 이미지"
                         class="bookmark-image">
                </div>
                <div class="bookmark-image-wrapper bookmark-no-image" 
                     th:if="${bookmark.imageUrl == null}">
                    <span class="no-image-text">이미지 없음</span>
                </div>
                
                <div class="bookmark-info">
                    <h3 class="bookmark-title" th:text="${bookmark.festivalName}">
                        축제 이름
                    </h3>
                    
                    <div class="bookmark-meta">
                        <span class="bookmark-period"
                              th:if="${bookmark.startDate != null and bookmark.endDate != null}"
                              th:text="${#temporals.format(bookmark.startDate, 'yyyy.MM.dd') + ' ~ ' + #temporals.format(bookmark.endDate, 'yyyy.MM.dd')}">
                            2025.12.11 ~ 2025.12.14
                        </span>
                        
                        <span class="bookmark-location" 
                              th:if="${bookmark.location != null and !#strings.isEmpty(bookmark.location)}"
                              th:text="${bookmark.location}">
                            부산 해운대구
                        </span>
                    </div>
                </div>
                
                <div class="bookmark-actions">
                    <a th:href="@{/festivals/{id}(id=${bookmark.festivalId})}"
                       class="btn-view">
                        상세보기
                    </a>
                    
                    <button type="button" 
                            class="btn-remove"
                            th:data-bookmark-id="${bookmark.bookmarkId}"
                            th:data-festival-name="${bookmark.festivalName}">
                        삭제
                    </button>
                </div>
            </div>
        </div>

        <div class="mypage-danger">
            <form th:action="@{/members/delete}" method="post">
                <button type="submit" class="btn-danger">회원 탈퇴</button>
            </form>
        </div>
    </section>
</main>

<script>
    // 북마크 삭제 기능
    document.querySelectorAll('.btn-remove').forEach(btn => {
        btn.addEventListener('click', async function() {
            const bookmarkId = this.dataset.bookmarkId;
            const festivalName = this.dataset.festivalName;
            
            if (!confirm(`'${festivalName}' 북마크를 삭제하시겠습니까?`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/bookmarks/${bookmarkId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('북마크가 삭제되었습니다.');
                    location.reload();
                } else {
                    const data = await response.json();
                    alert(data.error || '북마크 삭제에 실패했습니다.');
                }
            } catch (err) {
                console.error(err);
                alert('북마크 삭제 중 오류가 발생했습니다.');
            }
        });
    });
</script>

</body>
</html>