<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="|${festival.fcltyNm} - 축제 상세정보|">
        축제 상세정보
    </title>

    <!-- 공통 헤더/레이아웃 스타일 -->
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/festivals-home.css}">
    <!-- 상세페이지 전용 스타일 (hero, info-table, 지도 등) -->
    <link rel="stylesheet" th:href="@{/css/detail.css}">
</head>
<body>

<!-- 공통 헤더 프래그먼트 -->
<div th:replace="~{fragments/header :: siteHeader}"></div>

<main class="detail-layout">

    <!-- ===== 상단 히어로 영역 ===== -->
    <section class="festival-hero">
        <!-- 왼쪽: 텍스트 정보 -->
        <div class="hero-info">
            <p class="hero-badge">축제 상세정보</p>

            <h1 class="hero-title" th:text="${festival.fcltyNm}">
                부산국제아동도서전
            </h1>

            <div class="hero-meta">
                <div>
                    <span class="meta-label">기간</span>
                    <span class="meta-value"
                          th:text="${#temporals.format(festival.fstvlBeginDe, 'yyyy.MM.dd')} + ' ~ ' +
                                   ${#temporals.format(festival.fstvlEndDe,   'yyyy.MM.dd')}">
                        2025.12.11 ~ 2025.12.14
                    </span>
                </div>

                <div>
                    <span class="meta-label">장소</span>
                    <span class="meta-value"
                          th:text="${festival.ctprvnNm + ' ' + festival.signguNm}">
                        부산 해운대구
                    </span>
                </div>

                <div th:if="${festival.telNo}">
                    <span class="meta-label">문의</span>
                    <span class="meta-value" th:text="${festival.telNo}">
                        051-000-0000
                    </span>
                </div>

                <div th:if="${festival.hmpgAddr}">
                    <span class="meta-label">홈페이지</span>
                    <a class="meta-link"
                       th:href="${festival.hmpgAddr}"
                       target="_blank"
                       th:text="${festival.hmpgAddr}">
                        홈페이지 바로가기
                    </a>
                </div>
            </div>

            <!-- 예상 방문 소요 시간 같은 부가 정보가 있을 때만 표시 -->
            <p class="hero-expected"
               th:if="${expectedPeriod != null}"
               th:text="|예상 방문 소요 시간: ${expectedPeriod}|">
                예상 방문 소요 시간: 반나절
            </p>
        </div>

        <!-- 오른쪽: 대표 이미지 -->
        <div class="hero-image">
            <img th:if="${festival.firstImageUrl != null}"
                 th:src="${festival.firstImageUrl}"
                 alt="축제 대표 이미지">
            <div th:if="${festival.firstImageUrl == null}" class="hero-image-placeholder">
                대표 이미지가 없습니다.
            </div>
        </div>
    </section>

    <!-- ===== 축제 소개 섹션 ===== -->
    <section class="detail-section">
        <h2>축제 소개</h2>

        <!-- overview가 있으면 overview 사용 -->
        <p class="detail-overview" th:if="${festival.overview != null}"
           th:text="${festival.overview}">
            축제에 대한 소개 문구가 들어갑니다.
        </p>

        <!-- overview가 없고 fstvlCn이 있으면 fstvlCn 사용 -->
        <p class="detail-overview"
           th:if="${festival.overview == null && festival.fstvlCn != null}"
           th:text="${festival.fstvlCn}">
            상세 설명 텍스트
        </p>

        <!-- 둘 다 없으면 안내 문구 -->
        <p class="detail-overview"
           th:if="${festival.overview == null && festival.fstvlCn == null}">
            현재 제공되는 상세 소개 문구가 없습니다.
        </p>
    </section>

    <!-- ===== 기본 정보 테이블 ===== -->
    <section class="detail-section">
        <h2>기본 정보</h2>

        <table class="info-table">
            <tr>
                <th>개최 기간</th>
                <td th:text="${#temporals.format(festival.fstvlBeginDe, 'yyyy.MM.dd')} + ' ~ ' +
                             ${#temporals.format(festival.fstvlEndDe,   'yyyy.MM.dd')}">
                    2025.12.11 ~ 2025.12.14
                </td>
            </tr>
            <tr>
                <th>개최 장소</th>
                <td th:text="${festival.addr1}">
                    부산 해운대구 벡스코 일원
                </td>
            </tr>
            <tr th:if="${festival.originNm}">
                <th>주최 / 주관</th>
                <td th:text="${festival.originNm}">
                    주최/주관 정보
                </td>
            </tr>
            <tr th:if="${festival.mlsfcNm}">
                <th>축제 유형</th>
                <td th:text="${festival.mlsfcNm}">
                    전시/체험
                </td>
            </tr>
        </table>
    </section>

    <!-- ===== 위치 정보 & 지도 ===== -->
    <section class="detail-section">
        <h2>위치 정보</h2>

        <p class="detail-address" th:text="${festival.addr1}">
            주소 텍스트
        </p>

        <div id="festivalDetailMap" class="detail-map"></div>
    </section>

    <!-- ===== 축제 리뷰 ===== -->
    <section class="detail-section review-section">
        <div class="section-header">
            <h2 class="section-title">축제 리뷰</h2>
        </div>

        <!-- 리뷰가 하나도 없을 때 -->
        <div th:if="${#lists.isEmpty(reviews)}" class="review-empty">
            아직 등록된 리뷰가 없습니다. 첫 리뷰를 남겨보세요!
        </div>

        <!-- 리뷰 목록 -->
        <ul th:if="${!#lists.isEmpty(reviews)}" class="review-list">
            <li th:each="review : ${reviews}" class="review-item">
                <div class="review-header">
                    <div class="review-meta">
                        <span class="review-nickname"
                              th:text="${review.nickname}">닉네임</span>
                        <span class="review-date"
                              th:text="${#temporals.format(review.createdAt, 'yyyy.MM.dd')}">
                            2025.12.11
                        </span>
                    </div>
                    <div class="review-rating">
                        <span class="star">★</span>
                        <span th:text="${review.rating}">5</span>
                        <span class="rating-unit"> / 5</span>
                    </div>
                </div>

                <p class="review-content" th:text="${review.content}">
                    리뷰 내용입니다.
                </p>

                <div class="review-footer">
                    <a th:if="${review.attachmentId != null}"
                       th:href="@{/files/{id}(id=${review.attachmentId})}"
                       class="review-attachment">
                        첨부 이미지 다운로드
                    </a>

                    <!-- 본인 리뷰일 때만 수정/삭제 버튼 -->
                    <div class="review-actions"
                         th:if="${session.member != null and session.member.id == review.memberId}">
                        <button type="button"
                                class="btn-text edit-review-btn"
                                th:data-id="${review.id}"
                                th:data-content="${review.content}"
                                th:data-rating="${review.rating}">
                            수정
                        </button>
                        <button type="button"
                                class="btn-text delete-review-btn"
                                th:data-id="${review.id}">
                            삭제
                        </button>
                    </div>
                </div>
            </li>
        </ul>

        <!-- 로그인 안내 -->
        <div class="review-login-hint" th:if="${session.member == null}">
            리뷰를 남기려면 먼저
            <a th:href="@{/auth/login}" class="link-inline">로그인</a>
            해주세요.
        </div>
    </section>

    <!-- ===== 뒤로가기 / 목록 버튼 ===== -->
    <section class="detail-section">
        <a th:href="@{/festivals/list}" class="back-link">목록으로 돌아가기</a>
    </section>

</main>

<!-- ✅ 네이버 지도 API 스크립트 -->
<script type="text/javascript"
        src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=imrp8lidfv">
</script>

<!-- 상세 페이지 지도 스크립트 -->
<script th:inline="javascript">
/*<![CDATA[*/
    // 위도/경도 (엔티티 필드명에 맞게 fcltyLa, fcltyLo 사용)
    var lat = /*[[${festival.fcltyLa}]]*/ 35.1796;
    var lng = /*[[${festival.fcltyLo}]]*/ 129.0756;

    // 좌표가 없으면 기본값으로 부산 시청 근처 사용
    if (lat == null || lng == null) {
        lat = 35.1796;
        lng = 129.0756;
    }

    var map = new naver.maps.Map('festivalDetailMap', {
        center: new naver.maps.LatLng(lat, lng),
        zoom: 14
    });

    var marker = new naver.maps.Marker({
        position: new naver.maps.LatLng(lat, lng),
        map: map
    });
/*]]>*/
</script>

</body>
</html>
